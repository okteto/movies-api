dependencies:
  - https://github.com/okteto/movies-frontend

build:
  api: .

deploy:
  - name: Deploy MongoDB
    command: okteto deploy -f mongodb-compose.yml
  - name: Configure Helm with Okteto Registry
    command: echo "${OKTETO_TOKEN}" | helm registry login registry.demo.okteto.dev -u ${OKTETO_USERNAME} --password-stdin
  - name: Pull Helm Chart from Okteto Registry
    command: helm pull oci://registry.demo.okteto.dev/okteto/movies-api --version 0.1.0
  - name: Deploy API
    command: helm upgrade --install movies-api oci://registry.demo.okteto.dev/okteto/movies-api --version 0.1.0 --set image=${OKTETO_BUILD_API_IMAGE}

dev:
  api:
    command: bash
    sync:
      - .:/src
    forward:
      - 9229:9229
